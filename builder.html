<html>
  <head>
    
  </head>
  <body>
    <h1>Elements</h1>
    
    <div id="builderFrame" style="border:1px solid #000000;overflow:scroll;width:800px;height:600px;display:inline-block">
      <div id="builderCanvas" ondrop="addImageDrop()" style="position: relative; width:4000px; height:600px"></div>
    </div>


    <div style="display:inline-block; border: 1px solid black;">
      <h2>Images</h2>
      <p>https://opengameart.org/sites/default/files/2dplatform_0.png</p>
      <form>
        <h4>Add image</h4>
        <div>
          <label for="image_url">Url</label>
          <input id="image_url" type="text">
          <button type="button" onclick="loadImage()">Add</button>
        </div>
      </form>
      <div id="images"></div>
    </div>

    <script>
      function loadImage() {
        const imageUrlInput = document.getElementById('image_url')
        const imageUrl = imageUrlInput.value
        const imageList = document.getElementById('images')
        imageList.insertAdjacentHTML('afterbegin',
        `<div style="display:block;padding-top:5px;">
          <img src="`+imageUrl+`" width="100" height="100" draggable="true" onmousedown="addImageDrag()">
          <div>
            <label>w:</label>
            <input class="image_width" type="number" value="100">  
          </div>
          <div>
            <label>h:</label>
            <input class="image_height" type="number" value="100">  
          </div>
        </div>
        `
        )
        imageUrlInput.value = ''
      }

      let addingImage = null

      function addImageDrag() {
        let e = window.event;
        addingImage = {
          src: e.target.src,
          width: e.target.parentNode.getElementsByClassName('image_width')[0].value,
          height: e.target.parentNode.getElementsByClassName('image_height')[0].value
        }
      }

      const target = document.getElementById("builderCanvas");
      target.addEventListener("dragover", (event) => {
        // prevent default to allow drop
        event.preventDefault();
      });

      function addImageDrop() {
        console.log('dropping')
        let e = window.event;
        
        var rect = target.getBoundingClientRect(); 
        var posx = e.clientX - rect.left; 
        var posy = e.clientY - rect.top;

        if (addingImage) {
          e.target.insertAdjacentHTML('beforeend', '<image class="img_tile" style="left:'+posx+'px;top:'+posy+'px;position:absolute" src="'+addingImage.src+'" width="'+addingImage.width+'" height="'+addingImage.height+'">')
        }

        addingImage = null
      }
      
    </script>


  </body>
</html>